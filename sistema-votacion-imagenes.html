<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistema de Votaci√≥n de Im√°genes</title>
    <link href="https://fonts.googleapis.com/css2?family=Dosis:wght@300;400;600;700&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Dosis', sans-serif;
            background: linear-gradient(135deg, #dc770e 0%, #fbd21d 100%);
            min-height: 100vh;
            color: #000;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            text-align: center;
            color: #000;
            margin-bottom: 30px;
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(255,255,255,0.3);
            font-weight: 700;
        }

        /* Estilos para el login */
        .login-container {
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 80vh;
        }

        .login-box {
            background: rgba(255,255,255,0.95);
            border-radius: 20px;
            padding: 40px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            backdrop-filter: blur(10px);
            max-width: 400px;
            width: 100%;
            text-align: center;
        }

        .login-box h2 {
            margin-bottom: 30px;
            font-weight: 600;
            color: #000;
        }

        .login-option {
            margin-bottom: 20px;
        }

        .voter-btn {
            background: #dc770e;
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 25px;
            cursor: pointer;
            font-size: 18px;
            font-weight: 600;
            font-family: 'Dosis', sans-serif;
            transition: all 0.3s ease;
            width: 100%;
            margin-bottom: 15px;
        }

        .voter-btn:hover {
            background: #b8630c;
            transform: translateY(-2px);
        }

        .admin-section {
            border-top: 2px solid #eee;
            padding-top: 20px;
            margin-top: 20px;
        }

        .form-group {
            margin-bottom: 20px;
            text-align: left;
        }

        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: 600;
            color: #333;
        }

        .form-input {
            width: 100%;
            padding: 12px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 16px;
            font-family: 'Dosis', sans-serif;
            transition: border-color 0.3s ease;
        }

        .form-input:focus {
            outline: none;
            border-color: #dc770e;
        }

        .admin-btn {
            background: #fbd21d;
            color: #000;
            border: none;
            padding: 12px 30px;
            border-radius: 25px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 600;
            font-family: 'Dosis', sans-serif;
            transition: all 0.3s ease;
            width: 100%;
        }

        .admin-btn:hover {
            background: #e6bd0a;
            transform: translateY(-2px);
        }

        .user-info {
            position: fixed;
            top: 20px;
            right: 20px;
            background: rgba(255,255,255,0.9);
            padding: 10px 20px;
            border-radius: 20px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            z-index: 1000;
        }

        .logout-btn {
            background: #ff4444;
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 15px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 600;
            font-family: 'Dosis', sans-serif;
            margin-left: 10px;
            transition: all 0.3s ease;
        }

        .logout-btn:hover {
            background: #cc3333;
        }

        .nav-buttons {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin-bottom: 30px;
        }

        .nav-btn {
            padding: 12px 24px;
            background: rgba(255,255,255,0.9);
            border: 2px solid #dc770e;
            border-radius: 25px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 600;
            font-family: 'Dosis', sans-serif;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            color: #dc770e;
        }

        .nav-btn:hover:not(:disabled) {
            background: #dc770e;
            color: white;
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(220, 119, 14, 0.3);
        }

        .nav-btn.active {
            background: #dc770e;
            color: white;
        }

        .nav-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            background: #ccc;
            border-color: #ccc;
            color: #666;
        }

        .section {
            display: none;
            background: rgba(255,255,255,0.95);
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            backdrop-filter: blur(10px);
        }

        .section.active {
            display: block;
        }

        .upload-area {
            border: 3px dashed #ddd;
            border-radius: 15px;
            padding: 40px;
            text-align: center;
            background: #fafafa;
            margin-bottom: 20px;
            transition: all 0.3s ease;
        }

        .upload-area:hover {
            border-color: #dc770e;
            background: #fffbf0;
        }

        .upload-area.dragover {
            border-color: #fbd21d;
            background: #fffef0;
        }

        .file-input {
            display: none;
        }

        .upload-btn {
            background: #dc770e;
            color: white;
            padding: 15px 30px;
            border: none;
            border-radius: 25px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 600;
            font-family: 'Dosis', sans-serif;
            transition: all 0.3s ease;
        }

        .upload-btn:hover {
            background: #b8630c;
            transform: translateY(-2px);
        }

        .image-list {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .image-pair {
            background: white;
            border-radius: 15px;
            padding: 15px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            transition: transform 0.3s ease;
        }

        .image-pair:hover {
            transform: translateY(-5px);
        }

        .voting-container {
            text-align: center;
        }

        .voting-pair {
            background: white;
            border-radius: 20px;
            padding: 30px;
            margin-bottom: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
        }

        .voting-pair h3 {
            margin-bottom: 20px;
            color: #000;
            font-size: 1.5em;
            font-weight: 600;
        }

        .images-comparison {
            display: flex;
            justify-content: center;
            gap: 30px;
            margin-bottom: 30px;
            flex-wrap: wrap;
        }

        .vote-option {
            background: white;
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            transition: all 0.3s ease;
            cursor: pointer;
            border: 3px solid transparent;
        }

        .vote-option:hover {
            transform: translateY(-5px);
            border-color: #dc770e;
            box-shadow: 0 10px 25px rgba(220, 119, 14, 0.3);
        }

        .vote-option img {
            width: 300px;
            height: 300px;
            object-fit: cover;
            border-radius: 10px;
            margin-bottom: 15px;
        }

        .vote-btn {
            background: #dc770e;
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 25px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 600;
            font-family: 'Dosis', sans-serif;
            transition: all 0.3s ease;
            width: 100%;
        }

        .vote-btn:hover {
            background: #b8630c;
        }

        .vote-btn:disabled {
            background: #ccc;
            cursor: not-allowed;
        }

        .navigation-controls {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-top: 20px;
        }

        .nav-control {
            background: #fbd21d;
            color: #000;
            border: none;
            padding: 12px 25px;
            border-radius: 25px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 600;
            font-family: 'Dosis', sans-serif;
            transition: all 0.3s ease;
        }

        .nav-control:hover {
            background: #e6bd0a;
            transform: translateY(-2px);
        }

        .nav-control:disabled {
            background: #ccc;
            cursor: not-allowed;
        }

        .results-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
            gap: 25px;
        }

        .result-card {
            background: white;
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            transition: transform 0.3s ease;
        }

        .result-card:hover {
            transform: translateY(-5px);
        }

        .result-images {
            display: flex;
            gap: 15px;
            margin-bottom: 15px;
        }

        .result-img {
            width: 150px;
            height: 150px;
            object-fit: cover;
            border-radius: 10px;
        }

        .result-stats {
            background: #f5f5f5;
            padding: 15px;
            border-radius: 10px;
        }

        .winner {
            border: 3px solid #dc770e;
            background: #fffbf0;
        }

        .status-message {
            text-align: center;
            padding: 20px;
            margin: 20px 0;
            border-radius: 10px;
            font-weight: 600;
            font-family: 'Dosis', sans-serif;
        }

        .success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }

        .warning {
            background: #fff3cd;
            color: #856404;
            border: 1px solid #fbd21d;
        }

        .error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }

        .progress-bar {
            background: #e0e0e0;
            border-radius: 10px;
            overflow: hidden;
            margin: 20px 0;
        }

        .progress-fill {
            background: linear-gradient(90deg, #dc770e, #fbd21d);
            height: 20px;
            border-radius: 10px;
            transition: width 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #000;
            font-weight: 600;
            font-family: 'Dosis', sans-serif;
        }

        @media (max-width: 768px) {
            .images-comparison {
                flex-direction: column;
                align-items: center;
            }
            
            .vote-option img {
                width: 250px;
                height: 250px;
            }

            .user-info {
                position: static;
                margin: 10px 0;
                text-align: center;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Pantalla de Login -->
        <div id="login-screen">
            <div class="header">
                <h1>üó≥Ô∏è Sistema de Votaci√≥n de Im√°genes</h1>
                <p>Selecciona tu tipo de acceso</p>
            </div>
            
            <div class="login-container">
                <div class="login-box">
                    <h2>Bienvenido</h2>
                    
                    <div class="login-option">
                        <button class="voter-btn" onclick="loginAsVoter()">
                            üë• Entrar como Votante
                        </button>
                        <p style="font-size: 14px; color: #666; margin-top: 5px;">
                            Solo podr√°s votar por las im√°genes
                        </p>
                    </div>
                    
                    <div class="admin-section">
                        <h3 style="margin-bottom: 20px; font-weight: 600;">Acceso de Administrador</h3>
                        
                        <div class="form-group">
                            <label for="username">Usuario:</label>
                            <input type="text" id="username" class="form-input" placeholder="Ingresa tu usuario">
                        </div>
                        
                        <div class="form-group">
                            <label for="password">Contrase√±a:</label>
                            <input type="password" id="password" class="form-input" placeholder="Ingresa tu contrase√±a">
                        </div>
                        
                        <button class="admin-btn" onclick="loginAsAdmin()">
                            üëë Entrar como Administrador
                        </button>
                        
                        <p style="font-size: 12px; color: #666; margin-top: 10px;">
                            Podr√°s subir im√°genes, ver resultados y votar
                        </p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Aplicaci√≥n principal -->
        <div id="main-app" style="display: none;">
            <div class="header">
                <h1>üó≥Ô∏è Sistema de Votaci√≥n de Im√°genes</h1>
                <p>Carga pares de im√°genes y permite que los usuarios voten por sus favoritas</p>
            </div>

            <!-- Informaci√≥n del usuario -->
            <div class="user-info" id="userInfo"></div>

            <div class="nav-buttons">
                <button class="nav-btn" id="uploadBtn" onclick="showSection('upload')" disabled>üì§ Cargar Im√°genes</button>
                <button class="nav-btn active" onclick="showSection('vote')">üó≥Ô∏è Votar</button>
                <button class="nav-btn" id="resultsBtn" onclick="showSection('results')" disabled>üìä Resultados</button>
            </div>

            <!-- Secci√≥n de Carga -->
            <div id="upload-section" class="section">
                <h2 style="text-align: center; margin-bottom: 20px; font-weight: 600;">Cargar Pares de Im√°genes</h2>
                <p style="text-align: center; margin-bottom: 20px; color: #666;">Selecciona im√°genes que terminen en -1 y -2 (ej: foto-1.jpg, foto-2.jpg)</p>
                
                <div class="upload-area" id="uploadArea">
                    <div style="font-size: 3em; margin-bottom: 15px;">üìÅ</div>
                    <h3>Arrastra archivos aqu√≠ o haz clic para seleccionar</h3>
                    <p style="margin-top: 10px; color: #666;">Formatos soportados: JPG, PNG, GIF</p>
                    <input type="file" id="fileInput" class="file-input" multiple accept="image/*">
                    <button class="upload-btn" onclick="document.getElementById('fileInput').click()">
                        Seleccionar Im√°genes
                    </button>
                </div>

                <div id="imageList" class="image-list"></div>
            </div>

            <!-- Secci√≥n de Votaci√≥n -->
            <div id="vote-section" class="section active">
                <div class="voting-container">
                    <div id="votingContent"></div>
                    <div class="navigation-controls">
                        <button class="nav-control" id="prevBtn" onclick="previousPair()">‚¨ÖÔ∏è Anterior</button>
                        <span id="pairCounter" style="font-weight: 600; font-size: 18px;">Par 1 de 0</span>
                        <button class="nav-control" id="nextBtn" onclick="nextPair()">Siguiente ‚û°Ô∏è</button>
                    </div>
                </div>
            </div>

            <!-- Secci√≥n de Resultados -->
            <div id="results-section" class="section">
                <h2 style="text-align: center; margin-bottom: 30px; font-weight: 600;">üìä Resultados de Votaci√≥n</h2>
                <div id="resultsContent" class="results-grid"></div>
            </div>
        </div>
    </div>

    <script>
        // Variables globales
        let imagePairs = [];
        let currentPairIndex = 0;
        let votes = {};
        let votedPairs = new Set();
        let currentUser = null;
        let userRole = null;
        let personNames = {}; // Almacenar nombres de personas para cada par

        // Credenciales de administrador
        const ADMIN_CREDENTIALS = {
            username: 'admin',
            password: 'votacion2024'
        };

        // Generar un ID √∫nico para simular IP
        const userIP = 'user_' + Math.random().toString(36).substr(2, 9);

        // Inicializaci√≥n
        document.addEventListener('DOMContentLoaded', function() {
            loadVotesFromStorage();
            loadImagePairsFromStorage();
            loadPersonNamesFromStorage();
        });

        // Login como votante
        function loginAsVoter() {
            currentUser = 'Votante';
            userRole = 'voter';
            showMainApp();
            setupVoterInterface();
            showMessage('¬°Bienvenido! Puedes votar por tus im√°genes favoritas.', 'success');
        }

        // Login como administrador
        function loginAsAdmin() {
            const username = document.getElementById('username').value.trim();
            const password = document.getElementById('password').value.trim();

            if (username === ADMIN_CREDENTIALS.username && password === ADMIN_CREDENTIALS.password) {
                currentUser = 'Administrador';
                userRole = 'admin';
                showMainApp();
                setupAdminInterface();
                showMessage('¬°Bienvenido Administrador! Tienes acceso completo al sistema.', 'success');
            } else {
                showMessage('Usuario o contrase√±a incorrectos.', 'error');
                // Limpiar campos
                document.getElementById('username').value = '';
                document.getElementById('password').value = '';
            }
        }

        // Mostrar aplicaci√≥n principal
        function showMainApp() {
            document.getElementById('login-screen').style.display = 'none';
            document.getElementById('main-app').style.display = 'block';
            updateUserInfo();
            setupDragAndDrop();
        }

        // Configurar interfaz para votante
        function setupVoterInterface() {
            // Deshabilitar botones de admin
            document.getElementById('uploadBtn').disabled = true;
            document.getElementById('resultsBtn').disabled = true;
            
            // Ir directamente a votaci√≥n
            showSection('vote');
        }

        // Configurar interfaz para administrador
        function setupAdminInterface() {
            // Habilitar botones de admin, deshabilitar votar
            document.getElementById('uploadBtn').disabled = false;
            document.getElementById('resultsBtn').disabled = false;
            
            // Deshabilitar bot√≥n de votar para admin
            const voteBtn = document.querySelector('button[onclick="showSection(\'vote\')"]');
            if (voteBtn) {
                voteBtn.disabled = true;
                voteBtn.style.opacity = '0.5';
                voteBtn.title = 'Los administradores no pueden votar';
            }
            
            // Mostrar secci√≥n de carga
            showSection('upload');
        }

        // Actualizar informaci√≥n del usuario
        function updateUserInfo() {
            const userInfo = document.getElementById('userInfo');
            userInfo.innerHTML = `
                <span style="font-weight: 600;">üë§ ${currentUser}</span>
                <button class="logout-btn" onclick="logout()">Cerrar Sesi√≥n</button>
            `;
        }

        // Cerrar sesi√≥n
        function logout() {
            currentUser = null;
            userRole = null;
            document.getElementById('login-screen').style.display = 'block';
            document.getElementById('main-app').style.display = 'none';
            
            // Limpiar campos de login
            document.getElementById('username').value = '';
            document.getElementById('password').value = '';
            
            showMessage('Sesi√≥n cerrada correctamente.', 'success');
        }

        // Configurar drag and drop
        function setupDragAndDrop() {
            if (userRole !== 'admin') return;

            const uploadArea = document.getElementById('uploadArea');
            const fileInput = document.getElementById('fileInput');

            uploadArea.addEventListener('dragover', (e) => {
                e.preventDefault();
                uploadArea.classList.add('dragover');
            });

            uploadArea.addEventListener('dragleave', () => {
                uploadArea.classList.remove('dragover');
            });

            uploadArea.addEventListener('drop', (e) => {
                e.preventDefault();
                uploadArea.classList.remove('dragover');
                const files = Array.from(e.dataTransfer.files);
                handleFiles(files);
            });

            fileInput.addEventListener('change', (e) => {
                const files = Array.from(e.target.files);
                handleFiles(files);
            });
        }

        // Manejar archivos seleccionados
        function handleFiles(files) {
            if (userRole !== 'admin') {
                showMessage('No tienes permisos para subir archivos.', 'error');
                return;
            }

            const imageFiles = files.filter(file => file.type.startsWith('image/'));
            
            if (imageFiles.length === 0) {
                showMessage('No se encontraron archivos de imagen v√°lidos.', 'warning');
                return;
            }

            processImageFiles(imageFiles);
        }

        // Procesar archivos de imagen
        function processImageFiles(files) {
            const pairs = {};
            
            files.forEach(file => {
                const fileName = file.name;
                const lastDot = fileName.lastIndexOf('.');
                const nameWithoutExt = fileName.substring(0, lastDot);
                const extension = fileName.substring(lastDot);
                
                // Verificar si termina en -1 o -2
                if (nameWithoutExt.endsWith('-1')) {
                    const baseName = nameWithoutExt.slice(0, -2);
                    if (!pairs[baseName]) pairs[baseName] = {};
                    pairs[baseName].image1 = file;
                    pairs[baseName].name = baseName;
                } else if (nameWithoutExt.endsWith('-2')) {
                    const baseName = nameWithoutExt.slice(0, -2);
                    if (!pairs[baseName]) pairs[baseName] = {};
                    pairs[baseName].image2 = file;
                    pairs[baseName].name = baseName;
                }
            });

            // Filtrar pares completos
            const completePairs = Object.values(pairs).filter(pair => pair.image1 && pair.image2);
            
            if (completePairs.length === 0) {
                showMessage('No se encontraron pares completos de im√°genes (terminadas en -1 y -2).', 'warning');
                return;
            }

            // Agregar pares a la lista
            completePairs.forEach(pair => {
                const existingIndex = imagePairs.findIndex(p => p.name === pair.name);
                if (existingIndex >= 0) {
                    imagePairs[existingIndex] = pair;
                } else {
                    imagePairs.push(pair);
                }
            });

            // Mostrar formulario para asignar nombres
            showPersonNamesForm(completePairs);
        }

        // Mostrar formulario para asignar nombres a personas
        function showPersonNamesForm(newPairs) {
            const formContainer = document.createElement('div');
            formContainer.id = 'personNamesForm';
            formContainer.style.cssText = `
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: rgba(0,0,0,0.8);
                display: flex;
                justify-content: center;
                align-items: center;
                z-index: 10000;
            `;

            const formContent = document.createElement('div');
            formContent.style.cssText = `
                background: white;
                border-radius: 20px;
                padding: 30px;
                max-width: 600px;
                max-height: 80vh;
                overflow-y: auto;
                box-shadow: 0 10px 30px rgba(0,0,0,0.3);
            `;

            let formHTML = `
                <h2 style="text-align: center; margin-bottom: 20px; font-weight: 600; color: #dc770e;">
                    üë• Asignar Nombres a las Personas
                </h2>
                <p style="text-align: center; margin-bottom: 30px; color: #666;">
                    Escribe el nombre de cada persona en las im√°genes
                </p>
            `;

            newPairs.forEach((pair, index) => {
                const url1 = URL.createObjectURL(pair.image1);
                const url2 = URL.createObjectURL(pair.image2);
                
                // Obtener nombres existentes si ya est√°n guardados
                const existingNames = personNames[pair.name] || { person1: '', person2: '' };

                formHTML += `
                    <div style="border: 2px solid #eee; border-radius: 15px; padding: 20px; margin-bottom: 20px;">
                        <h3 style="text-align: center; margin-bottom: 15px; font-weight: 600;">Par: ${pair.name}</h3>
                        
                        <div style="display: flex; gap: 20px; align-items: center; justify-content: center; flex-wrap: wrap;">
                            <div style="text-align: center;">
                                <img src="${url1}" style="width: 120px; height: 120px; object-fit: cover; border-radius: 10px; margin-bottom: 10px;">
                                <p style="font-size: 12px; color: #666; margin-bottom: 5px;">${pair.image1.name}</p>
                                <input 
                                    type="text" 
                                    id="person1_${index}" 
                                    placeholder="Nombre de la persona"
                                    value="${existingNames.person1}"
                                    style="width: 140px; padding: 8px; border: 2px solid #ddd; border-radius: 8px; font-family: 'Dosis', sans-serif; text-align: center;"
                                >
                            </div>
                            
                            <div style="font-size: 24px; color: #dc770e; font-weight: bold;">VS</div>
                            
                            <div style="text-align: center;">
                                <img src="${url2}" style="width: 120px; height: 120px; object-fit: cover; border-radius: 10px; margin-bottom: 10px;">
                                <p style="font-size: 12px; color: #666; margin-bottom: 5px;">${pair.image2.name}</p>
                                <input 
                                    type="text" 
                                    id="person2_${index}" 
                                    placeholder="Nombre de la persona"
                                    value="${existingNames.person2}"
                                    style="width: 140px; padding: 8px; border: 2px solid #ddd; border-radius: 8px; font-family: 'Dosis', sans-serif; text-align: center;"
                                >
                            </div>
                        </div>
                    </div>
                `;
            });

            formHTML += `
                <div style="display: flex; gap: 15px; justify-content: center; margin-top: 30px;">
                    <button onclick="cancelPersonNames()" style="background: #ccc; color: #000; border: none; padding: 12px 25px; border-radius: 25px; cursor: pointer; font-size: 16px; font-weight: 600; font-family: 'Dosis', sans-serif;">
                        ‚ùå Cancelar
                    </button>
                    <button onclick="savePersonNamesFromForm()" style="background: #dc770e; color: white; border: none; padding: 12px 25px; border-radius: 25px; cursor: pointer; font-size: 16px; font-weight: 600; font-family: 'Dosis', sans-serif;">
                        ‚úÖ Guardar Nombres
                    </button>
                </div>
            `;

            formContent.innerHTML = formHTML;
            formContainer.appendChild(formContent);
            document.body.appendChild(formContainer);
        }

        // Nueva funci√≥n para guardar nombres desde el formulario
        function savePersonNamesFromForm() {
            // Obtener todos los campos de nombre del formulario
            const form = document.getElementById('personNamesForm');
            const person1Inputs = form.querySelectorAll('[id^="person1_"]');
            const person2Inputs = form.querySelectorAll('[id^="person2_"]');
            
            let allFieldsFilled = true;
            let savedCount = 0;
            
            // Procesar cada par
            for (let i = 0; i < person1Inputs.length; i++) {
                const person1 = person1Inputs[i].value.trim();
                const person2 = person2Inputs[i].value.trim();
                
                if (!person1 || !person2) {
                    allFieldsFilled = false;
                    continue;
                }
                
                // Encontrar el nombre del par correspondiente
                const pairName = imagePairs[i] ? imagePairs[i].name : null;
                if (pairName) {
                    personNames[pairName] = {
                        person1: person1,
                        person2: person2
                    };
                    savedCount++;
                }
            }
            
            if (!allFieldsFilled) {
                showMessage('Por favor, completa todos los nombres antes de continuar.', 'warning');
                return;
            }
            
            if (savedCount === 0) {
                showMessage('No se pudieron guardar los nombres. Intenta nuevamente.', 'error');
                return;
            }
            
            // Cerrar formulario
            const formElement = document.getElementById('personNamesForm');
            if (formElement) {
                formElement.remove();
            }
            
            // Actualizar visualizaci√≥n
            displayImagePairs();
            saveImagePairsToStorage();
            savePersonNamesToStorage();
            
            showMessage(`Se guardaron ${savedCount} pares con nombres correctamente.`, 'success');
        }

        // Guardar nombres de personas (funci√≥n original simplificada)
        function savePersonNames(pairNames) {
            let allFieldsFilled = true;
            
            pairNames.forEach((pairName, index) => {
                const person1 = document.getElementById(`person1_${index}`).value.trim();
                const person2 = document.getElementById(`person2_${index}`).value.trim();
                
                if (!person1 || !person2) {
                    allFieldsFilled = false;
                    return;
                }
                
                personNames[pairName] = {
                    person1: person1,
                    person2: person2
                };
            });
            
            if (!allFieldsFilled) {
                showMessage('Por favor, completa todos los nombres antes de continuar.', 'warning');
                return;
            }
            
            // Cerrar formulario
            const formElement = document.getElementById('personNamesForm');
            if (formElement) {
                formElement.remove();
            }
            
            // Actualizar visualizaci√≥n
            displayImagePairs();
            saveImagePairsToStorage();
            savePersonNamesToStorage();
            
            showMessage(`Se guardaron ${pairNames.length} pares con nombres correctamente.`, 'success');
        }

        // Cancelar asignaci√≥n de nombres
        function cancelPersonNames() {
            const formElement = document.getElementById('personNamesForm');
            if (formElement) {
                formElement.remove();
            }
        }

        // Mostrar pares de im√°genes cargados
        function displayImagePairs() {
            const imageList = document.getElementById('imageList');
            imageList.innerHTML = '';

            imagePairs.forEach((pair, index) => {
                const pairDiv = document.createElement('div');
                pairDiv.className = 'image-pair';
                
                const url1 = URL.createObjectURL(pair.image1);
                const url2 = URL.createObjectURL(pair.image2);
                
                // Obtener nombres de las personas
                const names = personNames[pair.name] || { person1: 'Persona 1', person2: 'Persona 2' };
                
                pairDiv.innerHTML = `
                    <h4 style="text-align: center; margin-bottom: 15px; font-weight: 600;">${pair.name}</h4>
                    <div style="display: flex; gap: 10px; justify-content: center;">
                        <div style="text-align: center;">
                            <img src="${url1}" style="width: 120px; height: 120px; object-fit: cover; border-radius: 8px;">
                            <p style="margin-top: 5px; font-size: 14px; font-weight: 600; color: #dc770e;">${names.person1}</p>
                            <p style="font-size: 12px; color: #666;">${pair.image1.name}</p>
                        </div>
                        <div style="display: flex; align-items: center; font-size: 20px; font-weight: bold; color: #dc770e;">VS</div>
                        <div style="text-align: center;">
                            <img src="${url2}" style="width: 120px; height: 120px; object-fit: cover; border-radius: 8px;">
                            <p style="margin-top: 5px; font-size: 14px; font-weight: 600; color: #dc770e;">${names.person2}</p>
                            <p style="font-size: 12px; color: #666;">${pair.image2.name}</p>
                        </div>
                    </div>
                    ${userRole === 'admin' ? `
                        <div style="display: flex; gap: 10px; margin-top: 15px;">
                            <button onclick="editPersonNames('${pair.name}', ${index})" style="flex: 1; padding: 8px; background: #fbd21d; color: #000; border: none; border-radius: 5px; cursor: pointer; font-family: 'Dosis', sans-serif; font-weight: 600;">
                                ‚úèÔ∏è Editar Nombres
                            </button>
                            <button onclick="removePair(${index})" style="flex: 1; padding: 8px; background: #ff4444; color: white; border: none; border-radius: 5px; cursor: pointer; font-family: 'Dosis', sans-serif; font-weight: 600;">
                                üóëÔ∏è Eliminar Par
                            </button>
                        </div>
                    ` : ''}
                `;
                
                imageList.appendChild(pairDiv);
            });
        }

        // Editar nombres de personas
        function editPersonNames(pairName, index) {
            const pair = imagePairs[index];
            showPersonNamesForm([pair]);
        }

        // Eliminar par de im√°genes
        function removePair(index) {
            if (userRole !== 'admin') {
                showMessage('No tienes permisos para eliminar im√°genes.', 'error');
                return;
            }

            const pairName = imagePairs[index].name;
            imagePairs.splice(index, 1);
            
            // Eliminar nombres asociados
            delete personNames[pairName];
            
            displayImagePairs();
            saveImagePairsToStorage();
            savePersonNamesToStorage();
            showMessage('Par de im√°genes eliminado.', 'success');
        }

        // Cambiar secci√≥n
        function showSection(section) {
            // Verificar permisos
            if ((section === 'upload' || section === 'results') && userRole !== 'admin') {
                showMessage('No tienes permisos para acceder a esta secci√≥n.', 'error');
                return;
            }
            
            // Verificar que admin no pueda votar
            if (section === 'vote' && userRole === 'admin') {
                showMessage('Los administradores no pueden votar.', 'error');
                return;
            }

            // Ocultar todas las secciones
            document.querySelectorAll('.section').forEach(s => s.classList.remove('active'));
            document.querySelectorAll('.nav-btn').forEach(btn => btn.classList.remove('active'));
            
            // Mostrar secci√≥n seleccionada
            document.getElementById(section + '-section').classList.add('active');
            event.target.classList.add('active');
            
            if (section === 'vote') {
                setupVoting();
            } else if (section === 'results') {
                displayResults();
            } else if (section === 'upload') {
                displayImagePairs();
            }
        }

        // Configurar votaci√≥n
        function setupVoting() {
            if (imagePairs.length === 0) {
                document.getElementById('votingContent').innerHTML = `
                    <div class="status-message warning">
                        No hay pares de im√°genes cargados. ${userRole === 'admin' ? 'Ve a la secci√≥n "Cargar Im√°genes" primero.' : 'Espera a que el administrador cargue im√°genes.'}
                    </div>
                `;
                return;
            }

            currentPairIndex = 0;
            displayVotingPair();
            updatePairCounter();
        }

        // Mostrar par actual para votaci√≥n
        function displayVotingPair() {
            if (currentPairIndex >= imagePairs.length) {
                document.getElementById('votingContent').innerHTML = `
                    <div class="status-message success">
                        ¬°Has revisado todos los pares de im√°genes!
                    </div>
                `;
                return;
            }

            const pair = imagePairs[currentPairIndex];
            const pairId = pair.name;
            const hasVoted = votedPairs.has(pairId);
            
            const url1 = URL.createObjectURL(pair.image1);
            const url2 = URL.createObjectURL(pair.image2);
            
            // Obtener nombres de las personas
            const names = personNames[pairId] || { person1: 'Persona 1', person2: 'Persona 2' };

            document.getElementById('votingContent').innerHTML = `
                <div class="voting-pair">
                    <h3>¬øCu√°l imagen prefieres?</h3>
                    <p style="text-align: center; color: #666; margin-bottom: 20px;">Competencia: ${pair.name}</p>
                    ${hasVoted ? '<div class="status-message success">Ya has votado en este par</div>' : ''}
                    <div class="images-comparison">
                        <div class="vote-option">
                            <img src="${url1}" alt="${names.person1}">
                            <h4 style="margin-bottom: 10px; font-weight: 600; color: #dc770e;">${names.person1}</h4>
                            <button class="vote-btn" onclick="vote('${pairId}', 1)" ${hasVoted ? 'disabled' : ''}>
                                ${hasVoted ? '‚úì Votado' : 'üëç Votar por ' + names.person1}
                            </button>
                        </div>
                        <div class="vote-option">
                            <img src="${url2}" alt="${names.person2}">
                            <h4 style="margin-bottom: 10px; font-weight: 600; color: #dc770e;">${names.person2}</h4>
                            <button class="vote-btn" onclick="vote('${pairId}', 2)" ${hasVoted ? 'disabled' : ''}>
                                ${hasVoted ? '‚úì Votado' : 'üëç Votar por ' + names.person2}
                            </button>
                        </div>
                    </div>
                </div>
            `;
        }

        // Votar por una imagen
        function vote(pairId, imageNumber) {
            if (votedPairs.has(pairId)) {
                showMessage('Ya has votado en este par de im√°genes.', 'warning');
                return;
            }

            // Inicializar votos si no existen
            if (!votes[pairId]) {
                votes[pairId] = { image1: 0, image2: 0 };
            }

            // Registrar voto
            votes[pairId]['image' + imageNumber]++;
            votedPairs.add(pairId);

            // Guardar en storage
            saveVotesToStorage();

            // Actualizar display
            displayVotingPair();
            showMessage('¬°Voto registrado correctamente!', 'success');
        }

        // Navegaci√≥n entre pares
        function previousPair() {
            if (currentPairIndex > 0) {
                currentPairIndex--;
                displayVotingPair();
                updatePairCounter();
            }
        }

        function nextPair() {
            if (currentPairIndex < imagePairs.length - 1) {
                currentPairIndex++;
                displayVotingPair();
                updatePairCounter();
            }
        }

        // Actualizar contador de pares
        function updatePairCounter() {
            const counter = document.getElementById('pairCounter');
            counter.textContent = `Par ${currentPairIndex + 1} de ${imagePairs.length}`;
            
            document.getElementById('prevBtn').disabled = currentPairIndex === 0;
            document.getElementById('nextBtn').disabled = currentPairIndex === imagePairs.length - 1;
        }

        // Mostrar resultados
        function displayResults() {
            const resultsContent = document.getElementById('resultsContent');
            
            if (imagePairs.length === 0) {
                resultsContent.innerHTML = `
                    <div class="status-message warning">
                        No hay pares de im√°genes para mostrar resultados.
                    </div>
                `;
                return;
            }

            resultsContent.innerHTML = '';

            imagePairs.forEach(pair => {
                const pairId = pair.name;
                const pairVotes = votes[pairId] || { image1: 0, image2: 0 };
                const totalVotes = pairVotes.image1 + pairVotes.image2;
                
                const url1 = URL.createObjectURL(pair.image1);
                const url2 = URL.createObjectURL(pair.image2);
                
                // Obtener nombres de las personas
                const names = personNames[pairId] || { person1: 'Persona 1', person2: 'Persona 2' };

                const winner = pairVotes.image1 > pairVotes.image2 ? 1 : 
                              pairVotes.image2 > pairVotes.image1 ? 2 : 0;

                const resultCard = document.createElement('div');
                resultCard.className = 'result-card';
                
                resultCard.innerHTML = `
                    <h3 style="text-align: center; margin-bottom: 15px; font-weight: 600;">Competencia: ${pair.name}</h3>
                    <div class="result-images">
                        <div style="text-align: center; ${winner === 1 ? 'border: 2px solid #dc770e; border-radius: 10px; padding: 5px;' : ''}">
                            <img src="${url1}" class="result-img">
                            <p style="margin-top: 8px; font-weight: 600; color: #dc770e; font-size: 16px;">${names.person1}</p>
                            <p style="color: #dc770e; font-weight: 600; font-size: 18px; margin-top: 5px;">${pairVotes.image1} votos</p>
                            ${winner === 1 ? '<p style="color: #dc770e; font-weight: 700; margin-top: 5px;">üèÜ GANADOR/A</p>' : ''}
                        </div>
                        <div style="text-align: center; ${winner === 2 ? 'border: 2px solid #dc770e; border-radius: 10px; padding: 5px;' : ''}">
                            <img src="${url2}" class="result-img">
                            <p style="margin-top: 8px; font-weight: 600; color: #dc770e; font-size: 16px;">${names.person2}</p>
                            <p style="color: #dc770e; font-weight: 600; font-size: 18px; margin-top: 5px;">${pairVotes.image2} votos</p>
                            ${winner === 2 ? '<p style="color: #dc770e; font-weight: 700; margin-top: 5px;">üèÜ GANADOR/A</p>' : ''}
                        </div>
                    </div>
                    <div class="result-stats">
                        <p style="text-align: center; font-weight: 600; margin-bottom: 10px;">Total de votos: ${totalVotes}</p>
                        ${totalVotes > 0 ? `
                            <div class="progress-bar">
                                <div class="progress-fill" style="width: ${totalVotes > 0 ? (pairVotes.image1 / totalVotes * 100) : 50}%">
                                    ${names.person1}: ${totalVotes > 0 ? Math.round(pairVotes.image1 / totalVotes * 100) : 0}%
                                </div>
                            </div>
                            <p style="text-align: center; font-size: 14px; color: #666; margin-top: 5px;">
                                ${names.person2}: ${totalVotes > 0 ? Math.round(pairVotes.image2 / totalVotes * 100) : 0}%
                            </p>
                        ` : '<p style="text-align: center; color: #666;">Sin votos a√∫n</p>'}
                        ${winner === 0 && totalVotes > 0 ? '<p style="text-align: center; color: #fbd21d; font-weight: 600; margin-top: 10px;">ü§ù EMPATE</p>' : ''}
                    </div>
                `;
                
                resultsContent.appendChild(resultCard);
            });
        }

        // Guardar votos en localStorage
        function saveVotesToStorage() {
            try {
                const data = {
                    votes: votes,
                    votedPairs: Array.from(votedPairs),
                    userIP: userIP
                };
                localStorage.setItem('votingData', JSON.stringify(data));
            } catch (e) {
                console.log('Error guardando datos:', e);
            }
        }

        // Cargar votos desde localStorage
        function loadVotesFromStorage() {
            try {
                const savedData = localStorage.getItem('votingData');
                if (savedData) {
                    const data = JSON.parse(savedData);
                    votes = data.votes || {};
                    votedPairs = new Set(data.votedPairs || []);
                }
            } catch (e) {
                console.log('Error cargando datos:', e);
            }
        }

        // Guardar nombres de personas en localStorage
        function savePersonNamesToStorage() {
            try {
                localStorage.setItem('personNames', JSON.stringify(personNames));
            } catch (e) {
                console.log('Error guardando nombres:', e);
            }
        }

        // Cargar nombres de personas desde localStorage
        function loadPersonNamesFromStorage() {
            try {
                const savedNames = localStorage.getItem('personNames');
                if (savedNames) {
                    personNames = JSON.parse(savedNames);
                }
            } catch (e) {
                console.log('Error cargando nombres:', e);
            }
        }

        // Guardar pares de im√°genes en localStorage
        function saveImagePairsToStorage() {
            try {
                // No podemos guardar archivos directamente, solo referencias
                const pairNames = imagePairs.map(pair => pair.name);
                localStorage.setItem('imagePairNames', JSON.stringify(pairNames));
            } catch (e) {
                console.log('Error guardando pares:', e);
            }
        }

        // Cargar pares de im√°genes desde localStorage
        function loadImagePairsFromStorage() {
            try {
                // Los archivos no se pueden persistir, solo cargamos cuando hay admin
                const savedPairNames = localStorage.getItem('imagePairNames');
                if (savedPairNames) {
                    // Los pares se cargar√°n cuando el admin suba los archivos nuevamente
                }
            } catch (e) {
                console.log('Error cargando pares:', e);
            }
        }

        // Mostrar mensajes de estado
        function showMessage(message, type) {
            const messageDiv = document.createElement('div');
            messageDiv.className = `status-message ${type}`;
            messageDiv.textContent = message;
            
            // Posicionar el mensaje en la parte superior
            messageDiv.style.position = 'fixed';
            messageDiv.style.top = '20px';
            messageDiv.style.left = '50%';
            messageDiv.style.transform = 'translateX(-50%)';
            messageDiv.style.zIndex = '1000';
            messageDiv.style.maxWidth = '500px';
            
            document.body.appendChild(messageDiv);
            
            setTimeout(() => {
                messageDiv.remove();
            }, 3000);
        }

        // Permitir login con Enter
        document.addEventListener('keydown', function(event) {
            if (event.key === 'Enter' && document.getElementById('login-screen').style.display !== 'none') {
                const username = document.getElementById('username').value.trim();
                const password = document.getElementById('password').value.trim();
                
                if (username || password) {
                    loginAsAdmin();
                }
            }
        });
    </script>
</body>
</html>